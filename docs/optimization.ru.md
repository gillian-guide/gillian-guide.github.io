title: Оптимизация
description: Методы оптимизации вашей установки GTA IV

# Оптимизация
Мы все знаем, насколько ужасной была оптимизация игры на момент выхода. К сожалению, у нас до сих пор нет идеального решения, но есть довольно хорошее.

## Драйвера
Это может показаться очевидным, но многие люди не устанавливают драйверы, поэтому я считаю необходимым упомянуть об этом. Выберите производителя ГП (для дискретного ГП, а не интегрированного) и следуйте инструкциям только для этого производителя.

=== "NVIDIA"
    === "NVCleanstall"
        !!! warning ""
            Этот способ установки больше рекомендуется, так как позволяет установить только то, что необходимо, например, если вам не хотите GeForce Experience или телеметрия.
        * Перейдите на [оффициальный сайт](https://www.techpowerup.com/nvcleanstall/).
        * Скачайте последнюю версию.
        * Запустите :material-file-download:`NVCleanstall_x.x.x.exe`.
        * Выберите `Install best driver for my hardware`.
        * Установите флажок на `Periodically check for driver updates in background` чтобы всегда иметь самые свежие драйверы.
        * Выберите нужные/необходимые компоненты (если не уверены - нажмите `Recommended`, прочитайте описания модулей и переключите их при необходимости).
        * После загрузки выберите необходимые опции (если не уверены - оставьте все как есть).
        * Установите драйвер.
    === "Оффициальные"
        !!! warning ""
            Этот метод устанавливает то, что вам, возможно, не нужно, например, телеметрию или GeForce Experience. Чтобы избежать этого, смотрите NVCleanstall.
        * Перейдите на [оффициальный сайт](https://www.nvidia.com/ru-ru/geforce/drivers/).
        * Установите GeForce Experience. Если драйвер нужен отдельно, выберите его в [поиске драйвера вручную](https://www.nvidia.com/Download/index.aspx?lang=ru-ru).
        * Следуйте инструкциям для установки драйвера.
=== "AMD"
    * Перейдите на [оффициальный сайт](https://www.amd.com/en/support).
    * Нажмите `Download Windows Drivers`. Если вы хотите выбрать драйвер вручную, воспользуйтесь приведенным ниже ручным поиском.
    * Следуйте инструкциям для установки драйвера.
    * Выберите драйвера `Optional` замисть `Recommended` для установки последней версии.
    * Выберите `Minimal Install` замисть `Full Install` если вам не нужны дополнительные фунцкии приложения Adrenaline.
=== "Intel"
    * Перейдите на [оффициальный сайт](https://www.intel.com/content/www/us/en/download-center/home.html).
    * Либо воспользуйтесь автоматическим инструментом для автоматического обнаружения и установки драйверов, либо просмотрите список видеодрайверов и установите нужный драйвер.
    * Следуйте инструкциям для установки драйвера.

## Автоматическое приложене для настройки
Благодаря [Kreato](https://gillian-guide.github.io/credits/#_4) и моим собственным усилиям, теперь вы можете настроить DXVK и [параметры запуска](https://gillian-guide.github.io/additional-setup/#launch-options) полуавтоматически. При этом автоматически проверяется железо и необходимые параметры, а также учитываются установленные моды.
!!! info "Использование"
    - [Скачайте приложение](https://drive.google.com/file/d/1RvaN4hfkyWJmfJzoOCtKN1eLFdQGmMOh/view?usp=drive_link) (если вы не доверяете надежности приложения, [доступен чистый скрипт](https://github.com/SandeMC/GTAIVSetupUtility)).
    - Запустите его и следуйте инструкциям в приложении.
    - Если возникнут какие-либо проблемы, [сообщите об этом на сервере Discord](contact-me.md).

## DXVK
На данный момент это единственное хорошее решение для повышения производительности игры.

!!! warning "Информация"
    * DXVK в основном повышает производительность ЦП за счет лучшей обработки вызовов drawcall - тех самых, которыми так злоупотребляет игра. Есть вероятность, что DXVK не улучшит производительность, если у вас слабее ГП.
    * DXVK официально не поддерживает Windows, но он прекрасно работает для GTA IV.
    * Для пользователей Linux, использующих Proton, вам необходима только [настройка](#_5), поскольку Proton уже использует DXVK. 
!!! warning "Требования"
    * Убедитесь, что у вас установлены последние [драйвера](#_2).
    * Убедитесь, что ваш ПК соответствует [требованиям DXVK](https://github.com/doitsujin/dxvk/wiki/Driver-support "DXVK GitHub Wiki") или хотя бы [требования DXVK Legacy](https://github.com/doitsujin/dxvk/wiki/Driver-support#dxvk-1103 "DXVK's GitHub Wiki") - предпочтительно рекомендуемым версиям. Большинство видеокарт 2014 года и новее должны поддерживать обычную версию, а видеокарты 2012 года и новее - Legacy версию, но вы можете использовать вкладку Advanced - Vulkan в [GPU-Z](https://www.techpowerup.com/download/gpu-z/ "TechPowerUp GPU-Z") чтобы проверить самостоятельно. Legacy версия имеет меньшую производительность и может содержать больше багов. 
    * Пользователи встроенной графики Intel могут установить только версию `1.10.1`.
    * Отключите кэш шейдеров в :material-steam:Steam в `Настройки` - `Загрузки`.

??? warning "Поддержка ENB"
    DXVK официально не поддерживает ENB (и наоборот) и настоятельно не рекомендуется сообществом ENB. Тем не менее, он будет работать для более простых эффектов, но при этом следует ожидать проблем.

    Не обращайте внимания, если не планируете использовать ENB.

### Какое улучшение мне ожидать?
Сложно сказать, поскольку улучшение DXVK может варьироваться от устройства к устройству. Но для приблизительного сравнения можно воспользоваться моим сравнением:
<iframe width="560" height="315" src="https://www.youtube.com/embed/mSSjw8uf5Rw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

### Установка { data-search-exclude }
=== "Последняя версия"
    !!! warning ""
        * Используйте эту версию, если ваша видеокарта поддерживает последнюю версию. Убедитесь в этом, ознакомившись с предупреждением выше.

    - Инструкции:
        * Перейдите на [релизы DXVK](https://github.com/doitsujin/dxvk/releases) и скачайте последнюю версию - :material-zip-box:`dxvk-x.x.tar.gz`.
        !!! note ""
            Вы также можете использовать [патч DXVK-gplasync](https://github.com/Sporif/dxvk-async/releases/tag/1.10.3) для более плавной игры на видеокартах AMD и Intel Arc, т.к. только у Nvidia есть прекомпиляция шейдеров на данный момент.
        * После скачивания откройте архив и перейдите по :material-zip-box:==dxvk-x.x.tar\\dxvk-x.x\\x32\\==
        * Распакуйте :fontawesome-solid-gears:`d3d9.dll` в папку с игрой.
    
    ??? question "Почему не :fontawesome-solid-gears:`dxgi.dll` или другие файлы в папке?"
        Игра использует графический API Direct3D 9. Остальные dll предназначены для Direct3D 10 и Direct3D 11. 

        Проще говоря, игра не будет использовать никакие другие файлы.
    
    ??? question "Почему :material-folder:==x32==? У меня 64-битная система"
        Ваша система в данном случае не имеет значения. Сама игра рассчитана на использование 32-битных библиотек, а не 64-битных.

        Проще говоря, игра не будет использовать файлы из :material-folder:==x64==.
    
    ??? warning "Если у вас возникли проблемы..."
        Используйте версию 2.2 или 2.0 - это последние версии, которые подтвержденно работают идеально.
       
        Если игра вообще не запускается, значит, ваша видеокарта не поддерживает последнюю версию. Вместо нее используйте версию Legacy.

        Просмотрите [исправление проблем](troubleshooting.md).
=== "Legacy версия"
    !!! warning ""
        * Используйте эту версию только в том случае, если ваша видеокарта поддерживает только Legacy версию. Убедитесь в этом, ознакомившись с предупреждением выше.
        * Если вы используете интегрированную графику от Intel, используйте версию [1.10.1](https://github.com/doitsujin/dxvk/releases/tag/v1.10.1)([async](https://github.com/Sporif/dxvk-async/releases/tag/1.10.1)).

    - Инструкции:
        * Перейдите на [релиз DXVK 1.10.3](https://github.com/doitsujin/dxvk/releases/tag/v1.10.3) и скачайте :material-zip-box:`dxvk-1.10.3.tar.gz`.
        !!! note ""
            Вы также можете использовать [DXVK-async 1.10.3](https://github.com/Sporif/dxvk-async/releases/tag/1.10.3) для более плавной игры.
        * После скачивания откройте архив и перейдите по :material-zip-box:==dxvk-1.10.3.tar_3\\dxvk-1.10.3\\x32\\==<br>Или :material-zip-box:==dxvk-async-1.10.3.tar_2\\dxvk-async-1.10.3\\x32\\==</br>
        * Распакуйте :fontawesome-solid-gears:`d3d9.dll` в папку с игрой.
    
    ??? question "Почему не :fontawesome-solid-gears:`dxgi.dll` или другие файлы в папке?"
        Игра использует графический API Direct3D 9. Остальные dll предназначены для Direct3D 10 и Direct3D 11. 

        Проще говоря, игра не будет использовать никакие другие файлы.
    
    ??? question "Почему :material-folder:==x32==? У меня 64-битная система"
        Ваша система в данном случае не имеет значения. Сама игра рассчитана на использование 32-битных библиотек, а не 64-битных.

        Проще говоря, игра не будет использовать файлы из :material-folder:==x64==.
    
    ??? warning "Если у вас возникли проблемы..."
        Если игра вообще не запускается, значит ваша видеокарта не поддерживает DXVK.

        Просмотрите [исправление проблем](troubleshooting.md).
### Настройка 
Создайте в папке с игрой файл :material-file-cog:`dxvk.conf` и добавьте в него с помощью любого текстового редактора следующие строки (взято из [PCGW](https://www.pcgamingwiki.com/wiki/Grand_Theft_Auto_IV#DXVK)):
``` { .py }
# maxFrameLatency используется для предотвращения или уменьшения случайных пропусков кадров и фризов. Эта опция устанавливает более строгую максимальную задержку кадров.
d3d9.maxFrameLatency = 1
# presentInterval используется для включения VSync. Мы будем использовать его в пользу игрового VSync. Так мы получим лучшую нагрузку на процессор.
d3d9.presentInterval = 1
# numBackBuffers может дополнительно улучшить стабильность FPS при использовании Vsync. Эта опция переопределяет количество обратных буферов для цепочки подкачки Vulkan.
d3d9.numBackBuffers = 3
```
Также добавьте `dxvk.enableAsync = true` если вы используете патч async и дополнительно `dxvk.gplAsyncCache = true` если используете патч gplasync.
??? abstract "Полный список настроек DXVK"
    Полный список можно посмотреть [здесь](https://github.com/doitsujin/dxvk/blob/master/dxvk.conf).
Также пройдите через [второстепенную настройку](additional-setup.md)

## DxWrapper
??? note "Что такое DxWrapper и как его использовать?"
    Некоторая часть сообщества GTA IV считает, что [DxWrapper](https://github.com/elishacloud/dxwrapper/releases/) может увеличить производительность. Из моих экспериментов следует, что использование `v1.0.6387.21` только ухудшило производительность и не дало никаких преимуществ. 
    
    Чтобы использовать его, извлеките :material-file:`dxwrapper.asi`, :material-file-edit:`dxwrapper.ini` и :fontawesome-solid-gears:`dxwrapper.dll`, и в :material-file-edit:`dxwrapper.ini` включите `DDrawCompat` и `DDrawCompatNoProcAffinity`.
    
    Если вы сможете мне доказать мне с помощью чётких сравнений, что это *может* повысить производительность, [свяжитесь со мной](contact-me.md).

[:material-page-first:Предыдущая страница <br>Введение</br>](index.md){ .md-button } [Следующая страница:material-page-last: <br>Второстепенная настройка</br>](additional-setup.md){ .md-button .md-button--primary }